<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Visão TV - Resumo de Vendas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="refresh" content="60"> <!-- Atualiza a cada 60 segundos -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Reset e configurações gerais */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html, body {
        height: 100%;
        overflow: hidden;
    }

    body {
        font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #121212;
        color: #ffffff;
        line-height: 1.6;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .spreadsheet-container {
        overflow: hidden;
        padding: 0;
        margin: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    table.spreadsheet-table {
        width: 100%;
        height: 100%;
        border-collapse: collapse;
        font-size: 1.8rem;
        font-weight: 500;
        color: #ffffff;
        margin: 0 auto;
    }

    table.spreadsheet-table th {
        background-color: #2c3e50;
        color: #FFD700;
        padding: 1.0rem 0.5rem;
        text-align: center;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 1.5rem;
        letter-spacing: 0.8px;
        border-bottom: 2px solid #FFD700;
        position: sticky;
        top: 0;
        z-index: 5;
    }

    table.spreadsheet-table td {
        padding: 1.0rem 0.5rem;
        text-align: center;
        border-bottom: 1px solid #333;
        transition: background-color 0.2s;
        font-weight: 500;
    }
    
    table.spreadsheet-table td:nth-child(n+2):nth-child(-n+6) {
        border-left: 1px solid #FFD700;
        border-right: 1px solid #FFD700;
    }

    table.spreadsheet-table tbody tr:nth-child(odd) {
        background-color: #1a1a1a;
    }

    table.spreadsheet-table tbody tr:nth-child(even) {
        background-color: #1d1d1d;
    }

    table.spreadsheet-table tbody tr:hover {
        background-color: #2a2a2a;
    }

    .employee-name {
        background-color: #2c3e50 !important;
        color: #FFD700 !important;
        font-weight: 700;
        text-align: left;
        padding-left: 1.0rem;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        text-transform: uppercase;
    }

    .total-cell {
        background-color: #2d2d2d !important;
        font-weight: 600;
        color: #FFD700 !important;
        border-left: 2px solid #FFD700;
    }

    .daily-totals {
        background-color: #333 !important;
        font-weight: 600;
        border-top: 2px solid #FFD700;
    }

    .daily-totals td {
        color: #FFD700 !important;
        font-weight: 600;
    }

    /* === DESTAQUES DIÁRIOS === */
    .highlight-level-1 { color: #FFA500 !important; }
    .highlight-level-2 { color: #FF8C00 !important; }
    .highlight-level-3 {
        color: #FF4500 !important;
        animation: pulse-orange 1.2s infinite;
    }

    /* === DESTAQUE SEMANAL (SÓ SEXTA) === */
    @keyframes gold-orange-pulse {
        0%, 100% {
            color: #FFD700;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
            transform: scale(1);
        }
        50% {
            color: #FF4500;
            text-shadow: 0 0 20px rgba(255, 69, 0, 1);
            transform: scale(1.03);
        }
    }

    .weekly-champion-name,
    .weekly-champion-total {
        animation: gold-orange-pulse 1.4s infinite;
        font-weight: 700 !important;
    }

    /* Animação reutilizada para destaque diário nível 3 */
    @keyframes pulse-orange {
        0%, 100% {
            text-shadow: 0 0 8px rgba(255, 69, 0, 0.9);
            transform: scale(1);
        }
        50% {
            text-shadow: 0 0 20px rgba(255, 69, 0, 1);
            transform: scale(1.03);
        }
    }
  </style>
</head>
<body>
  <div class="spreadsheet-container">
    <table class="spreadsheet-table">
      <thead>
        <tr>
          <th>Vendedor</th>
          <th>Segunda</th>
          <th>Terça</th>
          <th>Quarta</th>
          <th>Quinta</th>
          <th>Sexta</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for linha in dados %}
        <tr data-vendedor="{{ linha.nome }}">
          <td class="employee-name">{{ linha.nome }}</td>
          <td data-dia="seg">R$ {{ linha.seg | format_brl }}</td>
          <td data-dia="ter">R$ {{ linha.ter | format_brl }}</td>
          <td data-dia="qua">R$ {{ linha.qua | format_brl }}</td>
          <td data-dia="qui">R$ {{ linha.qui | format_brl }}</td>
          <td data-dia="sex">R$ {{ linha.sex | format_brl }}</td>
          <td class="total-cell">R$ {{ linha.total | format_brl }}</td>
        </tr>
        {% endfor %}

        <!-- Linha de Total Diário -->
        <tr class="daily-totals">
          <td><strong>Total Diário</strong></td>
          <td>R$ {{ totais_diarios.seg | format_brl }}</td>
          <td>R$ {{ totais_diarios.ter | format_brl }}</td>
          <td>R$ {{ totais_diarios.qua | format_brl }}</td>
          <td>R$ {{ totais_diarios.qui | format_brl }}</td>
          <td>R$ {{ totais_diarios.sex | format_brl }}</td>
          <td class="total-cell">R$ {{
            (totais_diarios.seg + totais_diarios.ter + totais_diarios.qua + totais_diarios.qui + totais_diarios.sex) | format_brl
          }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    // Converte "R$ 123.456,78" para número
    function parseBRL(text) {
        return parseFloat(
            text
                .replace(/[^0-9,-]/g, '')
                .replace(',', '.')
        ) || 0;
    }

    // Destaque DIÁRIO (seg a sex)
    function applyDailyHighlight() {
        const thresholds = { level1: 100000, level2: 200000, level3: 300000 };
        const today = new Date();
        const dayMap = { 1: 'seg', 2: 'ter', 3: 'qua', 4: 'qui', 5: 'sex' };
        const todayDataDay = dayMap[today.getDay()];

        if (!todayDataDay) return;

        document.querySelectorAll('tbody tr:not(.daily-totals)').forEach(row => {
            const nameCell = row.querySelector('.employee-name');
            const dailyCell = row.querySelector(`td[data-dia="${todayDataDay}"]`);

            nameCell.classList.remove('highlight-level-1', 'highlight-level-2', 'highlight-level-3');

            if (dailyCell) {
                const value = parseBRL(dailyCell.textContent);
                if (value >= thresholds.level3) nameCell.classList.add('highlight-level-3');
                else if (value >= thresholds.level2) nameCell.classList.add('highlight-level-2');
                else if (value >= thresholds.level1) nameCell.classList.add('highlight-level-1');
            }
        });
    }

    // Destaque SEMANAL (só na sexta): campeão pisca dourado/laranja
    function applyWeeklyChampionHighlight() {
        const today = new Date();
        if (today.getDay() !== 5) return; // 5 = sexta-feira

        const rows = document.querySelectorAll('tbody tr:not(.daily-totals)');
        let maxTotal = -1;
        let championRow = null;

        rows.forEach(row => {
            const totalCell = row.querySelector('.total-cell');
            if (totalCell) {
                const totalValue = parseBRL(totalCell.textContent);
                if (totalValue > maxTotal) {
                    maxTotal = totalValue;
                    championRow = row;
                }
            }
        });

        // Remove destaque anterior
        document.querySelectorAll('.weekly-champion-name, .weekly-champion-total').forEach(el => {
            el.classList.remove('weekly-champion-name', 'weekly-champion-total');
        });

        // Aplica ao campeão
        if (championRow) {
            const nameCell = championRow.querySelector('.employee-name');
            const totalCell = championRow.querySelector('.total-cell');
            if (nameCell) nameCell.classList.add('weekly-champion-name');
            if (totalCell) totalCell.classList.add('weekly-champion-total');
        }
    }

    // Executa ao carregar
    document.addEventListener('DOMContentLoaded', () => {
        applyDailyHighlight();
        applyWeeklyChampionHighlight();
    });
  </script>
</body>
</html>