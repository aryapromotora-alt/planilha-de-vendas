<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informativo - Arya Promotora</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; background-color: #0a0a0a; color: #ffffff; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; align-items: center; overflow: hidden; padding: 30px; }
        .top-section { text-align: center; width: 100%; max-width: 1200px; }
        .logo { max-width: 220px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 179, 71, 0.2 ); }
        .clock-container { margin-top: 15px; }
        #time { font-size: 8rem; font-weight: 700; color: #FFB347; line-height: 1; text-shadow: 0 0 20px rgba(255, 179, 71, 0.4); }
        #date { font-size: 2.4rem; font-weight: 300; color: #cccccc; text-transform: capitalize; margin-top: 8px; }
        .weather-container { background: rgba(255, 255, 255, 0.05); border-radius: 24px; padding: 28px 40px; width: 90%; max-width: 1000px; display: flex; justify-content: space-around; align-items: center; border: 1px solid rgba(255, 179, 71, 0.3); backdrop-filter: blur(8px); }
        .weather-item { text-align: center; min-width: 280px; }
        .temp-main { font-size: 5.5rem; font-weight: 700; color: #ffffff; }
        .weather-desc { font-size: 2rem; color: #FFB347; text-transform: capitalize; margin-top: -6px; }
        .weather-details { font-size: 1.8rem; color: #aaaaaa; text-align: left; line-height: 1.6; }
        .location { font-size: 1.6rem; color: #FFB347; margin-bottom: 8px; font-weight: 700; }
        #loading { font-size: 1.8rem; color: #FFB347; }
        @media (max-width: 1920px) { #time { font-size: 8rem; } .temp-main { font-size: 5.5rem; } }
        @media (max-width: 1366px) { #time { font-size: 6rem; } .temp-main { font-size: 4.5rem; } .logo { max-width: 180px; } }
    </style>
</head>
<body>
    <div class="top-section">
        <img src="/static/logo.png" alt="Arya Promotora" class="logo">
        <div class="clock-container">
            <div id="time">00:00:00</div>
            <div id="date">Carregando data...</div>
        </div>
    </div>

    <div class="weather-container" id="weather-box">
        <div id="loading">Carregando previsão do tempo...</div>
    </div>

    <script>
        function updateClock() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const saoPauloTime = new Date(utc - (3 * 3600000));
            const h = String(saoPauloTime.getHours()).padStart(2, '0');
            const m = String(saoPauloTime.getMinutes()).padStart(2, '0');
            const s = String(saoPauloTime.getSeconds()).padStart(2, '0');
            document.getElementById('time').textContent = `${h}:${m}:${s}`;
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            let dateString = saoPauloTime.toLocaleDateString('pt-BR', options);
            dateString = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            document.getElementById('date').textContent = dateString;
        }

        async function updateWeather() {
            // Coordenadas precisas para Vila Matilde, SP
            const lat = -23.5356;
            const lon = -46.5204;
            const apiKeyOWM = 'ee60a5b81a7eb26554d26d3892694d8e'; 
            const weatherBox = document.getElementById('weather-box');

            try {
                // Buscamos dados de 3 fontes para garantir precisão
                const [resOWM, resOM, resHG] = await Promise.allSettled([
                    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKeyOWM}&units=metric&lang=pt_br`),
                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code&timezone=America%2FSao_Paulo`),
                    fetch(`https://api.hgbrasil.com/weather?format=json&city_name=Vila%20Matilde,SP`)
                ]);

                let temp = null;
                let feelsLike = null;
                let humidity = null;
                let description = "Nublado";
                let isRaining = false;
                let rainVolume = 0;

                // 1. Processar HG Brasil (Geralmente mais preciso para SP/Vila Matilde local)
                if (resHG.status === 'fulfilled' && resHG.value.ok) {
                    const data = await resHG.value.json();
                    temp = data.results.temp;
                    humidity = data.results.humidity;
                    description = data.results.description;
                    if (data.results.condition_slug === 'rain' || data.results.rain > 0) isRaining = true;
                }

                // 2. Processar Open-Meteo (Excelente para temperatura em tempo real e precipitação)
                if (resOM.status === 'fulfilled' && resOM.value.ok) {
                    const data = await resOM.value.json();
                    const current = data.current;
                    // Se HG falhou ou deu valor muito alto, usamos este
                    if (temp === null || temp > 26) temp = current.temperature_2m;
                    feelsLike = current.apparent_temperature;
                    if (humidity === null) humidity = current.relative_humidity_2m;
                    
                    // Lógica de chuva agressiva (se o usuário diz que chove, qualquer sinal conta)
                    if (current.precipitation > 0 || [51, 53, 55, 61, 63, 65, 80, 81, 82, 95, 96, 99].includes(current.weather_code)) {
                        isRaining = true;
                        rainVolume = current.precipitation;
                    }
                }

                // 3. Processar OpenWeatherMap (Backup e descrição)
                if (resOWM.status === 'fulfilled' && resOWM.value.ok) {
                    const data = await resOWM.value.json();
                    if (temp === null) temp = data.main.temp;
                    if (feelsLike === null) feelsLike = data.main.feels_like;
                    if (humidity === null) humidity = data.main.humidity;
                    
                    const owmRain = data.weather[0].main.toLowerCase().includes('rain') || 
                                    data.weather[0].main.toLowerCase().includes('drizzle') || 
                                    data.weather[0].main.toLowerCase().includes('thunderstorm');
                    if (owmRain) isRaining = true;
                    if (data.rain) rainVolume = Math.max(rainVolume, data.rain['1h'] || 0);
                }

                // Fallback final se tudo falhar
                temp = temp || 24;
                feelsLike = feelsLike || temp;
                humidity = humidity || 70;

                const rainText = isRaining ? `⚠️ Chuva detectada` : "Sem previsão de chuva agora";
                const rainColor = isRaining ? '#ff4444' : '#44ff44';

                weatherBox.innerHTML = `
                    <div class="weather-item">
                        <div class="location">VILA MATILDE, SP</div>
                        <div class="temp-main">${Math.round(temp)}°C</div>
                        <div class="weather-desc">${description}</div>
                    </div>
                    <div class="weather-details">
                        <p style="font-size: 2rem; color: #ffffff; margin: 0 0 5px 0;">Sensação: ${Math.round(feelsLike)}°C</p>
                        <p style="font-size: 2rem; color: #ffffff; margin: 0 0 10px 0;">Umidade: ${humidity}%</p>
                        <p style="color: ${rainColor}; font-size: 1.8rem; margin: 0; font-weight: 700;">
                            ${rainText} ${rainVolume > 0 ? `(${rainVolume}mm)` : ''}
                        </p>
                    </div>
                `;

            } catch (error) {
                console.error("Erro geral:", error);
                weatherBox.innerHTML = `<div id="loading">Erro ao carregar clima.</div>`;
            }
        }

        updateClock();
        setInterval(updateClock, 1000);
        updateWeather();
        setInterval(updateWeather, 300000); 
        setTimeout(() => { window.location.reload(); }, 3600000);
    </script>
</body>
</html>
